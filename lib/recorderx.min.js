!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Recorderx={})}(this,function(e){"use strict";function a(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t){for(var r=new Float32Array(t),a=0,i=0;a<e.length;i+=e[a].length,a+=1)r.set(e[a],i);return r}function l(e,t,r){if(t<r)throw new Error('Invalid parameter: "inputSampleRate" must be greater than "outputSampleRate"');for(var a=e.length,i=(t+=0)/(r+=0),n=Math.ceil(a*r/t),o=new Float32Array(n),s=0,c=0;c<n;c+=1)o[c]=e[Math.floor(s)],s+=i;return o}function h(e,t){if(-1===[8,16].indexOf(t))throw new Error('Invalid parameter: "sampleBits" must be 8 or 16');for(var r=e.length*(t/8),a=new ArrayBuffer(r),i=new DataView(a),n=0,o=0;n<e.length;n+=1,o+=t/8){var s=Math.max(-1,Math.min(1,e[n])),c=s<0?32768*s:32767*s;8===t?i.setInt8(o,parseInt(255/(65535/(32768+c)),10),!0):i.setInt16(o,c,!0)}return i.buffer}function v(e,t,r){if(-1===[8,16].indexOf(t))throw new Error('Invalid parameter: "sampleBits" must be 8 or 16');function a(e){for(var t=0;t<e.length;t+=1)o.setUint8(s+t,e.charCodeAt(t))}var i=e.length*(t/8),n=new ArrayBuffer(44+i),o=new DataView(n),s=0;a("RIFF"),s+=4,o.setUint32(s,36+i,!0),s+=4,a("WAVE"),s+=4,a("fmt "),s+=4,o.setUint32(s,16,!0),s+=4,o.setUint16(s,1,!0),s+=2,o.setUint16(s,1,!0),s+=2,o.setUint32(s,r,!0),s+=4,o.setUint32(s,r*(t/8),!0),s+=4,o.setUint16(s,t/8*1,!0),s+=2,o.setUint16(s,t,!0),s+=2,a("data"),s+=4,o.setUint32(s,i,!0),s+=4;for(var c=0;c<e.length;c+=1,s+=t/8){var u=Math.max(-1,Math.min(1,e[c])),l=u<0?32768*u:32767*u;8===t?o.setInt8(s,parseInt(255/(65535/(32768+l)),10),!0):o.setInt16(s,l,!0)}return new Blob([o],{type:"audio/wav"})}var m={recordable:!0,sampleRate:16e3,sampleBits:16,bufferSize:16384},p={READY:0,RECORDING:1},b={RAW:"raw",PCM:"pcm",WAV:"wav"},t=function(){function f(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:m,t=e.recordable,r=void 0===t?m.recordable:t,a=e.bufferSize,i=void 0===a?m.bufferSize:a,n=e.sampleRate,o=void 0===n?m.sampleRate:n,s=e.sampleBits,c=void 0===s?m.sampleBits:s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,f),d(this,"state",p.READY),d(this,"ctx",new(window.AudioContext||window.webkitAudioContext)),d(this,"sampleRate",m.sampleRate),d(this,"sampleBits",m.sampleBits),d(this,"recordable",m.recordable),d(this,"recorder",null),d(this,"source",null),d(this,"stream",null),d(this,"buffer",[]),d(this,"bufferSize",0);var u=this.ctx,l=u.createScriptProcessor||u.createJavaScriptNode;this.recorder=l.call(u,i,1,1),this.recordable=r,this.sampleRate=o,this.sampleBits=c}var e,t,r;return e=f,(t=[{key:"start",value:function(i){var n=this;return this.clear(),new Promise(function(a,t){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){var t=n.recorder,r=n.ctx.createMediaStreamSource(e);n.stream=e,n.source=r,t.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);n.recordable&&(n.buffer.push(t.slice(0)),n.bufferSize+=t.length),"function"==typeof i&&i(t)},r.connect(t),t.connect(n.ctx.destination),n.state=p.RECORDING,a(e)}).catch(function(e){t(e)})})}},{key:"pause",value:function(){this.stream.getAudioTracks().forEach(function(e){e.stop()}),this.recorder.disconnect(),this.source.disconnect(),this.state=p.READY}},{key:"clear",value:function(){this.buffer=[],this.bufferSize=0}},{key:"getRecord",value:function(e){var t=0<arguments.length&&void 0!==e?e:{encodeTo:b.RAW,compressible:!1},r=t.encodeTo,a=void 0===r?b.RAW:r,i=t.compressible,n=void 0!==i&&i;if(this.recordable){var o=u(this.buffer,this.bufferSize),s=this.ctx.sampleRate,c=(n=n&&this.sampleRate<s)?this.sampleRate:s;switch(n&&(o=l(o,s,c)),a){case b.RAW:return o;case b.PCM:return h(o,this.sampleBits);case b.WAV:return v(o,this.sampleBits,c);default:throw new Error('Invalid parameter: "encodeTo" must be ENCODE_TYPE')}}throw new Error('Configuration error: "recordable" must be set to true')}}])&&a(e.prototype,t),r&&a(e,r),f}();void 0!==window&&void 0!==navigator&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(r){var a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return a?new Promise(function(e,t){a.call(navigator,r,e,t)}):Promise.reject(new Error("getUserMedia is not implemented in this environment"))}));var r={merge:u,compress:l,encodeToPCM:h,encodeToWAV:v};e.ENCODE_TYPE=b,e.RECORDER_STATE=p,e.audioTools=r,e.default=t,Object.defineProperty(e,"__esModule",{value:!0})});
