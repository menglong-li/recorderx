!function(e){"function"==typeof define&&define.amd?define(e):e()}(function(){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e,t,r){if(-1===[8,16].indexOf(t))throw new Error('Invalid parameter: "sampleBits" must be 8 or 16');function n(e){for(var t=0;t<e.length;t+=1)o.setUint8(s+t,e.charCodeAt(t))}var a=e.length*(t/8),i=new ArrayBuffer(44+a),o=new DataView(i),s=0;n("RIFF"),s+=4,o.setUint32(s,36+a,!0),s+=4,n("WAVE"),s+=4,n("fmt "),s+=4,o.setUint32(s,16,!0),s+=4,o.setUint16(s,1,!0),s+=2,o.setUint16(s,1,!0),s+=2,o.setUint32(s,r,!0),s+=4,o.setUint32(s,r*(t/8),!0),s+=4,o.setUint16(s,t/8*1,!0),s+=2,o.setUint16(s,t,!0),s+=2,n("data"),s+=4,o.setUint32(s,a,!0),s+=4;for(var c=0;c<e.length;c+=1,s+=t/8){var l=Math.max(-1,Math.min(1,e[c])),u=l<0?32768*l:32767*l;8===t?o.setInt8(s,parseInt(255/(65535/(32768+u)),10),!0):o.setInt16(s,u,!0)}return new Blob([o],{type:"audio/wav"})}var m={recordable:!0,sampleRate:16e3,sampleBits:16,bufferSize:16384},h={READY:0,RECORDING:1},u="raw",v="pcm",p="wav",e=function(){function d(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:m,t=e.recordable,r=void 0===t?m.recordable:t,n=e.bufferSize,a=void 0===n?m.bufferSize:n,i=e.sampleRate,o=void 0===i?m.sampleRate:i,s=e.sampleBits,c=void 0===s?m.sampleBits:s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,d),f(this,"state",h.READY),f(this,"ctx",new(window.AudioContext||window.webkitAudioContext)),f(this,"sampleRate",m.sampleRate),f(this,"sampleBits",m.sampleBits),f(this,"recordable",m.recordable),f(this,"recorder",null),f(this,"source",null),f(this,"stream",null),f(this,"buffer",[]),f(this,"bufferSize",0);var l=this.ctx,u=l.createScriptProcessor||l.createJavaScriptNode;this.recorder=u.call(l,a,1,1),this.recordable=r,this.sampleRate=o,this.sampleBits=c}var e,t,r;return e=d,(t=[{key:"start",value:function(a){var i=this;return this.clear(),new Promise(function(n,t){navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){var t=i.recorder,r=i.ctx.createMediaStreamSource(e);i.stream=e,i.source=r,t.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);i.recordable&&(i.buffer.push(t.slice(0)),i.bufferSize+=t.length),"function"==typeof a&&a(t)},r.connect(t),t.connect(i.ctx.destination),i.state=h.RECORDING,n(e)}).catch(function(e){t(e)})})}},{key:"pause",value:function(){this.stream.getAudioTracks().forEach(function(e){e.stop()}),this.recorder.disconnect(),this.source.disconnect(),this.state=h.READY}},{key:"clear",value:function(){this.buffer=[],this.bufferSize=0}},{key:"getRecord",value:function(e){var t=0<arguments.length&&void 0!==e?e:{encodeTo:u,compressible:!1},r=t.encodeTo,n=void 0===r?u:r,a=t.compressible,i=void 0!==a&&a;if(this.recordable){var o=function(e,t){for(var r=new Float32Array(t),n=0,a=0;n<e.length;a+=e[n].length,n+=1)r.set(e[n],a);return r}(this.buffer,this.bufferSize),s=this.ctx.sampleRate,c=(i=i&&this.sampleRate<s)?this.sampleRate:s;switch(i&&(o=function(e,t,r){if(t<r)throw new Error('Invalid parameter: "inputSampleRate" must be greater than "outputSampleRate"');for(var n=e.length,a=(t+=0)/(r+=0),i=Math.ceil(n*r/t),o=new Float32Array(i),s=0,c=0;c<i;c+=1)o[c]=e[Math.floor(s)],s+=a;return o}(o,s,c)),n){case u:return o;case v:return function(e,t){if(-1===[8,16].indexOf(t))throw new Error('Invalid parameter: "sampleBits" must be 8 or 16');for(var r=e.length*(t/8),n=new ArrayBuffer(r),a=new DataView(n),i=0,o=0;i<e.length;i+=1,o+=t/8){var s=Math.max(-1,Math.min(1,e[i])),c=s<0?32768*s:32767*s;8===t?a.setInt8(o,parseInt(255/(65535/(32768+c)),10),!0):a.setInt16(o,c,!0)}return a.buffer}(o,this.sampleBits);case p:return l(o,this.sampleBits,c);default:throw new Error('Invalid parameter: "encodeTo" must be ENCODE_TYPE')}}throw new Error('Configuration error: "recordable" must be set to true')}}])&&n(e.prototype,t),r&&n(e,r),d}();void 0!==window&&void 0!==navigator&&(void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(r){var n=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return n?new Promise(function(e,t){n.call(navigator,r,e,t)}):Promise.reject(new Error("getUserMedia is not implemented in this environment"))}));var t,r=document.getElementById("btn-start"),a=document.getElementById("btn-pause"),i=document.getElementById("btn-clear"),o=document.getElementById("log"),s=document.getElementById("audio");function c(e,t){var r=1<arguments.length&&void 0!==t?t:"",n='<span style="margin-right:8px">\n           '.concat((new Date).toLocaleString(),':\n         </span>\n         <span style="color:').concat(r?"red":"blue",'">\n           ').concat(e," ").concat(r,"\n         </span>"),a=document.createElement("div");a.innerHTML=n,o.appendChild(a)}r.addEventListener("click",function(){(t=t||new e({recordable:!0,sampleRate:16e3})).state===h.READY&&t.start().then(function(){c("start recording")}).catch(function(e){c("Recording failed.",e)})}),a.addEventListener("click",function(){t&&t.state===h.RECORDING&&(t.pause(),s.src=URL.createObjectURL(t.getRecord({encodeTo:p,compressible:!0})),c("pause recording"))}),i.addEventListener("click",function(){t.clear()})});
//# sourceMappingURL=demo.min.js.map
